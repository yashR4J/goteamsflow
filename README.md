## Analyzing MS Teams Meeting Characteristics and Session Setup Performance from Packet Captures

This repository contains tools to analyze various performance-related metrics of Microsoft Teams calls using packet captures (PCAP files). The tools allow for detection of different flow types such as DNS, TCP, UDP, RTP, STUN, and provide in-depth analysis of session setup times, volumetric flows, and media traffic like audio, video, and screen sharing. You can generate logs and visualize the results through structured plots.

### Key Features

- Flow Detection: Identifies Microsoft Teams-related traffic from PCAP files, such as DNS queries, RTP (audio/video/screen share) flows, TCP/UDP flows, and STUN traffic.
- Session Setup Time Analysis: Captures the time taken for establishing Microsoft Teams sessions and plots session setup times for different operating systems.
- Volumetric Traffic Flow Analysis: Generates plots for packet-per-second rates of different flow types (TCP, RTP, STUN, UDP).
- Call Flow Diagram: Visualizes Microsoft Teams call flows to understand the sequence of media and control message exchanges.

### Packet Analyzer (Go Script)

**Prerequisites**

- Go version 1.15 or later
- libpcap (optional for processing PCAP files)

**Build Instructions**

To build the Go-based packet analyzer:

```bash
go build -o goteamsflow main.go
```

**Usage Instructions**

This Go-based tool processes Microsoft Teams traffic captured in PCAP files. It can analyse DNS, RTP, TCP, UDP, and STUN flows and output logs or CSV files for further analysis.

**Running the Packet Processor**

```bash
./goteamsflow --pcap "<pcap_files_pattern>" --logs "all" --plot "all" --output "output.csv"
```

**Command Line Options:**

- `--pcap`: (Required) Glob pattern or a comma-separated list of PCAP files.
- `--logs`: Specifies log types to output (e.g., dns, tcp, udp, stun, rtp, session_setup, all).
- `--plot`: Specifies which plots to generate (e.g., windows, linux, ios, all).
- `--output`: (Optional) CSV file path to save the logs. If not specified, logs are printed to the console.

**Example Commands:**

Process all PCAP files in the current directory:

```bash
./goteamsflow --pcap "*.pcap" --logs "all" --output "logs.csv"
```

Generate session setup plots for Windows and output logs:

```bash
./goteamsflow --pcap "*.pcap" --logs "session_setup" --plot "windows" --output 
```

**Output**

- CSV Logs: Contains detailed records of detected flows, including timestamps, source/destination IPs, session states, and flow types (DNS, RTP, TCP, etc.).
- Plots: If plotting is enabled, the tool generates session setup time plots and traffic flow visualizations.

### Data Analysis Tool

A Python-based tool is provided to analyze logs generated by the Go script and generate visualizations like session setup times, call flow diagrams, and volumetric traffic flow plots.

**Prerequisites**

Make sure you have Python 3.x installed and the required dependencies:

```bash
pip install -r requirements.txt
```

**Running the tool**

```bash
./plotter <csv_files> --flow_types RTP STUN --output "output.png"
```


**Command Line Arguments:**

- `filenames`: CSV file(s) generated by the Go script.
- `--output`: (Optional) Name of the output plot file (e.g., output.png).
- `--flow_types`: Flow types to include in the plot (RTP, RTCP, STUN, UDP, TCP, DNS, Session Setup, ALL).
- `--window`: Smoothing window size for volumetric plots (default: 100).
- `--plot`: Displays over 20 different plotting variations. If not specified, the program enters an interactive mode.

**Example Commands:**

Plot volumetric flows for RTP and STUN traffic:

```bash
./plotter logs.csv --flow_types RTP STUN --plot volumetric_flows
```

Generate a session setup time plot:

```bash
./plotter logs.csv --plot session_setup_time_based
```

### License

This project's source code is released under the [GNU Affero General Public License v3](https://www.gnu.org/licenses/agpl-3.0.html). In particular,
* You are entitled to redistribute the program or its modified version, however you must also make available the full source code and a copy of the license to the recipient. Any modified version or derivative work must also be licensed under the same licensing terms.
* You also must make available a copy of the modified program's source code available, under the same licensing terms, to all users interacting with the modified program remotely through a computer network.
